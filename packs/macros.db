{"_id":"MACRORANDOMITEMFROMCOMPENDIUM","name":"Get Random Item(s) from Compendium","permission":{"default":0},"type":"script","sort":100001,"flags":{},"scope":"global","command":"let packOptions = game.packs.map(pack => `<option value=\"${pack.collection}\">${pack.title}</option>`);\n\nconst form = `  \n  <div style=\"display: inline-block\">\n    <label for=\"destinationPack\">Compendium:</label>\n    <select id=\"destinationPack\" />\n      ${packOptions}\n    </select>\n  </div>\n\n\n  <br>\n\n  <div style=\"display: inline-block\">\n    <label for=\"rollNum\">Number of roll:</label>\n    <input type=\"number\" id=\"rollNum\" required value=\"1\">\n  </div>  \n`;\n\nconst dialog = new Dialog({\n  title: \"Random object from compendium\",\n  content: form,\n  buttons: {\n    use: {\n      label: \"Apply\",\n      callback: rollInCompendium\n    }\n  }\n}).render(true);\n\nasync function rollInCompendium(html) {\n  const compendiumName = html.find(`select#destinationPack`)[0].value;\n  const numberOfRoll = html.find(`input#rollNum`)[0].value;\n\n  let c = [];\n\n  for (let r = 1; r <= numberOfRoll; r++) {\n    game.packs.get(compendiumName).getIndex().then(compendium => {\n      let i = Math.floor(Math.random() * compendium.length);\n\n      c.push(`@Compendium[${compendiumName}.${compendium[i]._id}]`);\n    });\n  };\n\n  setTimeout(function(){\n\n    ChatMessage.create({\n      content: c.toString(),\n      whisper: game.users.entities.filter(u => u.isGM).map(u => u._id)\n    });\n\n  }, 1000);\n}","img":"modules/nice-cypher-add-ons/img/card_pickup.svg","actorIds":[]}
